<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crazy Eights</title>
    <style>
        body {
            background-color: #333333;
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        #gameContainer {
            display: grid;
            grid-template-areas:
                "computer"
                "discard"
                "player"
                "controls"
                "status";
            grid-template-rows: 180px 1fr 180px auto auto;
            width: 600px;
            height: 800px;
            background-color: #222222;
            border: 2px solid #ff9000;
            border-radius: 10px;
            padding: 10px;
            box-sizing: border-box;
            position: relative;
        }
        #computerHand {
            grid-area: computer;
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
        }
        #playerHand {
            grid-area: player;
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
        }
        .hand-row {
            display: flex;
            justify-content: center;
            height: 90px; /* Height of one row */
        }
        #computerHand .card, #playerHand .card {
            width: 60px;
            height: 90px;
            margin-left: -20px; /* Overlap by ~1/3 of width (60px / 3 = 20px) */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative; /* Ensure cards stay in place */
        }
        #computerHand .card:first-child, #playerHand .card:first-child {
            margin-left: 0; /* No overlap for the first card */
        }
        #discardPile {
            grid-area: discard;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #discardPile .card {
            width: 60px;
            height: 90px;
            margin: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            position: relative; /* Ensure it stays fixed */
        }
        .selected {
            outline: 2px solid #ff9000; /* Use outline to prevent movement */
        }
        #controls {
            grid-area: controls;
            display: flex;
            justify-content: space-around;
            padding: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #ff9000;
            color: white;
            cursor: pointer;
            touch-action: manipulation;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #e68300;
        }
        #status {
            grid-area: status;
            text-align: center;
            padding: 10px;
            color: white;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: white;
            z-index: 10;
        }
        #welcomeScreen {
            display: flex;
        }
        #winScreen, #loseScreen {
            display: none;
        }
        .overlay button {
            padding: 10px 20px;
            font-size: 16px;
            margin-left: 10px;
            border: none;
            border-radius: 5px;
            background-color: #ff9000;
            color: white;
            cursor: pointer;
        }
        .overlay button:hover {
            background-color: #e68300;
        }
        @media (max-width: 600px) {
            #gameContainer {
                width: 100vw;
                height: 100vh;
                border: none;
                border-radius: 0;
            }
            #computerHand, #playerHand {
                height: 24vh; /* Two rows scaled for mobile */
            }
            .hand-row {
                height: 12vh; /* Adjust for mobile */
            }
            #computerHand .card, #playerHand .card {
                width: 12vw;
                height: auto;
                margin-left: -4vw; /* Scaled overlap (~1/3 of 12vw) */
            }
            #computerHand .card:first-child, #playerHand .card:first-child {
                margin-left: 0;
            }
            #discardPile .card {
                width: 12vw;
                height: auto;
            }
            button {
                padding: 8px 16px;
                font-size: 14px;
            }
            #status {
                font-size: 16px;
            }
            .overlay {
                font-size: 20px;
            }
            .overlay button {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="computerHand"></div>
        <div id="discardPile"></div>
        <div id="playerHand"></div>
        <div id="controls">
            <button id="drawCardButton">Draw Card</button>
            <button id="discardButton">Discard Selected Card</button>
            <button id="newGameButton">New Game</button>
        </div>
        <div id="status">Your turn</div>
        <div id="welcomeScreen" class="overlay">Welcome to Crazy Eights! Click to start.</div>
        <div id="winScreen" class="overlay">You win! <button id="playAgainWin">Play Again</button></div>
        <div id="loseScreen" class="overlay">You lose! <button id="playAgainLose">Play Again</button></div>
    </div>

    <script>
        const cardURLs = {
            "2H": "https://raw.githubusercontent.com/Angelyze/Cards/main/24.png",
            "3H": "https://raw.githubusercontent.com/Angelyze/Cards/main/34.png",
            "4H": "https://raw.githubusercontent.com/Angelyze/Cards/main/44.png",
            "5H": "https://raw.githubusercontent.com/Angelyze/Cards/main/54.png",
            "6H": "https://raw.githubusercontent.com/Angelyze/Cards/main/64.png",
            "7H": "https://raw.githubusercontent.com/Angelyze/Cards/main/74.png",
            "8H": "https://raw.githubusercontent.com/Angelyze/Cards/main/84.png",
            "9H": "https://raw.githubusercontent.com/Angelyze/Cards/main/94.png",
            "10H": "https://raw.githubusercontent.com/Angelyze/Cards/main/104.png",
            "JH": "https://raw.githubusercontent.com/Angelyze/Cards/main/J4.png",
            "QH": "https://raw.githubusercontent.com/Angelyze/Cards/main/Q4.png",
            "KH": "https://raw.githubusercontent.com/Angelyze/Cards/main/K4.png",
            "AH": "https://raw.githubusercontent.com/Angelyze/Cards/main/A4.png",
            "2D": "https://raw.githubusercontent.com/Angelyze/Cards/main/23.png",
            "3D": "https://raw.githubusercontent.com/Angelyze/Cards/main/33.png",
            "4D": "https://raw.githubusercontent.com/Angelyze/Cards/main/43.png",
            "5D": "https://raw.githubusercontent.com/Angelyze/Cards/main/53.png",
            "6D": "https://raw.githubusercontent.com/Angelyze/Cards/main/63.png",
            "7D": "https://raw.githubusercontent.com/Angelyze/Cards/main/73.png",
            "8D": "https://raw.githubusercontent.com/Angelyze/Cards/main/83.png",
            "9D": "https://raw.githubusercontent.com/Angelyze/Cards/main/93.png",
            "10D": "https://raw.githubusercontent.com/Angelyze/Cards/main/103.png",
            "JD": "https://raw.githubusercontent.com/Angelyze/Cards/main/J3.png",
            "QD": "https://raw.githubusercontent.com/Angelyze/Cards/main/Q3.png",
            "KD": "https://raw.githubusercontent.com/Angelyze/Cards/main/K3.png",
            "AD": "https://raw.githubusercontent.com/Angelyze/Cards/main/A3.png",
            "2C": "https://raw.githubusercontent.com/Angelyze/Cards/main/22.png",
            "3C": "https://raw.githubusercontent.com/Angelyze/Cards/main/32.png",
            "4C": "https://raw.githubusercontent.com/Angelyze/Cards/main/42.png",
            "5C": "https://raw.githubusercontent.com/Angelyze/Cards/main/52.png",
            "6C": "https://raw.githubusercontent.com/Angelyze/Cards/main/62.png",
            "7C": "https://raw.githubusercontent.com/Angelyze/Cards/main/72.png",
            "8C": "https://raw.githubusercontent.com/Angelyze/Cards/main/82.png",
            "9C": "https://raw.githubusercontent.com/Angelyze/Cards/main/92.png",
            "10C": "https://raw.githubusercontent.com/Angelyze/Cards/main/102.png",
            "JC": "https://raw.githubusercontent.com/Angelyze/Cards/main/J2.png",
            "QC": "https://raw.githubusercontent.com/Angelyze/Cards/main/Q2.png",
            "KC": "https://raw.githubusercontent.com/Angelyze/Cards/main/K2.png",
            "AC": "https://raw.githubusercontent.com/Angelyze/Cards/main/A2.png",
            "2S": "https://raw.githubusercontent.com/Angelyze/Cards/main/21.png",
            "3S": "https://raw.githubusercontent.com/Angelyze/Cards/main/31.png",
            "4S": "https://raw.githubusercontent.com/Angelyze/Cards/main/41.png",
            "5S": "https://raw.githubusercontent.com/Angelyze/Cards/main/51.png",
            "6S": "https://raw.githubusercontent.com/Angelyze/Cards/main/61.png",
            "7S": "https://raw.githubusercontent.com/Angelyze/Cards/main/71.png",
            "8S": "https://raw.githubusercontent.com/Angelyze/Cards/main/81.png",
            "9S": "https://raw.githubusercontent.com/Angelyze/Cards/main/91.png",
            "10S": "https://raw.githubusercontent.com/Angelyze/Cards/main/101.png",
            "JS": "https://raw.githubusercontent.com/Angelyze/Cards/main/J1.png",
            "QS": "https://raw.githubusercontent.com/Angelyze/Cards/main/Q1.png",
            "KS": "https://raw.githubusercontent.com/Angelyze/Cards/main/K1.png",
            "AS": "https://raw.githubusercontent.com/Angelyze/Cards/main/A1.png",
            "back": "https://raw.githubusercontent.com/Angelyze/Cards/main/back.png"
        };

        const rankMap = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const suitMap = ['H', 'D', 'C', 'S'];

        let deck = [];
        let playerHand = [];
        let computerHand = [];
        let discardPile = [];
        let currentSuit = '';
        let playerTurn = true;
        let selectedCardIndex = null;

        const computerHandDiv = document.getElementById('computerHand');
        const discardPileDiv = document.getElementById('discardPile');
        const playerHandDiv = document.getElementById('playerHand');
        const statusDiv = document.getElementById('status');
        const drawCardButton = document.getElementById('drawCardButton');
        const discardButton = document.getElementById('discardButton');
        const newGameButton = document.getElementById('newGameButton');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const winScreen = document.getElementById('winScreen');
        const loseScreen = document.getElementById('loseScreen');
        const playAgainWin = document.getElementById('playAgainWin');
        const playAgainLose = document.getElementById('playAgainLose');

        drawCardButton.addEventListener('click', drawCard);
        discardButton.addEventListener('click', discardSelectedCard);
        newGameButton.addEventListener('click', startNewGame);
        welcomeScreen.addEventListener('click', startGame);
        playAgainWin.addEventListener('click', restartGame);
        playAgainLose.addEventListener('click', restartGame);

        /** Waits for a specified time (helper for delays) */
        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        /** Creates a new 52-card deck */
        function createDeck() {
            deck = [];
            for (let rank = 0; rank < 13; rank++) {
                for (let suit = 0; suit < 4; suit++) {
                    deck.push({ rank, suit });
                }
            }
        }

        /** Shuffles an array using Fisher-Yates algorithm */
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /** Deals initial cards to player and computer */
        function dealCards() {
            if (deck.length < 11) {
                console.error("Not enough cards in deck to deal!");
                return;
            }
            playerHand = deck.slice(0, 5);
            computerHand = deck.slice(5, 10);
            deck = deck.slice(10);
            discardPile = [deck.pop()];
            currentSuit = discardPile[0].suit;
            if (rankMap[discardPile[0].rank] === '8') {
                currentSuit = suitMap[Math.floor(Math.random() * 4)];
                statusDiv.textContent = `Game started with an 8. Suit is ${suitMap[currentSuit]}.`;
            } else {
                statusDiv.textContent = `Game started. Match ${suitMap[currentSuit]} or ${rankMap[discardPile[0].rank]}.`;
            }
        }

        /** Updates the UI with current hands and discard pile */
        function displayHands() {
            playerHandDiv.innerHTML = '';
            const playerRow1Div = document.createElement('div');
            playerRow1Div.className = 'hand-row';
            const playerRow2Div = document.createElement('div');
            playerRow2Div.className = 'hand-row';
            const row1 = playerHand.slice(0, 5);
            const row2 = playerHand.slice(5, 10); // Limit to 5 cards in second row
            row1.forEach((card, index) => {
                const img = document.createElement('img');
                img.src = cardURLs[`${rankMap[card.rank]}${suitMap[card.suit]}`];
                img.className = 'card';
                if (index === selectedCardIndex) img.classList.add('selected');
                img.addEventListener('click', () => selectCard(index));
                playerRow1Div.appendChild(img);
            });
            row2.forEach((card, index) => {
                const img = document.createElement('img');
                img.src = cardURLs[`${rankMap[card.rank]}${suitMap[card.suit]}`];
                img.className = 'card';
                if (index + 5 === selectedCardIndex) img.classList.add('selected');
                img.addEventListener('click', () => selectCard(index + 5));
                playerRow2Div.appendChild(img);
            });
            playerHandDiv.appendChild(playerRow1Div);
            playerHandDiv.appendChild(playerRow2Div);

            computerHandDiv.innerHTML = '';
            const compRow1Div = document.createElement('div');
            compRow1Div.className = 'hand-row';
            const compRow2Div = document.createElement('div');
            compRow2Div.className = 'hand-row';
            const compRow1 = computerHand.slice(0, 5);
            const compRow2 = computerHand.slice(5, 10);
            compRow1.forEach(() => {
                const img = document.createElement('img');
                img.src = cardURLs["back"];
                img.className = 'card';
                compRow1Div.appendChild(img);
            });
            compRow2.forEach(() => {
                const img = document.createElement('img');
                img.src = cardURLs["back"];
                img.className = 'card';
                compRow2Div.appendChild(img);
            });
            computerHandDiv.appendChild(compRow1Div);
            computerHandDiv.appendChild(compRow2Div);

            discardPileDiv.innerHTML = '';
            if (discardPile.length > 0) {
                const img = document.createElement('img');
                img.src = cardURLs[`${rankMap[discardPile[discardPile.length - 1].rank]}${suitMap[discardPile[discardPile.length - 1].suit]}`];
                img.className = 'card';
                discardPileDiv.appendChild(img);
            }
        }

        /** Selects a card in the player's hand */
        function selectCard(index) {
            if (!playerTurn) return;
            selectedCardIndex = index;
            displayHands();
        }

        /** Draws cards from the deck until playable or deck is empty */
        async function drawCard() {
            if (!playerTurn) return;
            if (deck.length === 0) {
                statusDiv.textContent = "Deck empty. Computer’s turn.";
                playerTurn = false;
                setTimeout(computerTurn, 1000);
                return;
            }

            let canPlay = false;
            while (deck.length > 0 && !canPlay) {
                const newCard = deck.pop();
                playerHand.push(newCard);
                canPlay = canDiscard(newCard);
                displayHands();
                statusDiv.textContent = canPlay ? "You drew a playable card!" : "You drew a card.";
                if (!canPlay) {
                    await wait(500);
                }
            }
            if (!canPlay) {
                statusDiv.textContent = "No playable cards drawn. Computer’s turn.";
                playerTurn = false;
                setTimeout(computerTurn, 1000);
            }
        }

        /** Discards the player's selected card if valid */
        function discardSelectedCard() {
            if (!playerTurn || selectedCardIndex === null) return;
            const card = playerHand[selectedCardIndex];
            if (canDiscard(card)) {
                discardPile.push(playerHand.splice(selectedCardIndex, 1)[0]);
                if (rankMap[card.rank] === '8') {
                    callSuit();
                } else {
                    currentSuit = card.suit;
                    statusDiv.textContent = `You played ${rankMap[card.rank]}${suitMap[card.suit]}. Computer's turn.`;
                }
                selectedCardIndex = null;
                displayHands();
                checkWin();
                if (playerHand.length > 0) {
                    playerTurn = false;
                    setTimeout(computerTurn, 1000);
                }
            } else {
                statusDiv.textContent = "Invalid card! Must match suit, rank, or be an 8.";
            }
        }

        /** Checks if a card can be discarded */
        function canDiscard(card) {
            const topCard = discardPile[discardPile.length - 1];
            return card.suit === currentSuit || rankMap[card.rank] === rankMap[topCard.rank] || rankMap[card.rank] === '8';
        }

        /** Assigns a new suit when an Eight is played */
        function callSuit() {
            currentSuit = suitMap[Math.floor(Math.random() * 4)];
            statusDiv.textContent = `You played an 8 and chose ${currentSuit}. Computer's turn.`;
        }

        /** Handles the computer's turn */
        async function computerTurn() {
            if (playerTurn) return;
            statusDiv.textContent = "Computer's turn...";
            let validCards = computerHand.filter(card => canDiscard(card));
            if (validCards.length > 0) {
                const cardToDiscard = validCards[Math.floor(Math.random() * validCards.length)];
                computerHand.splice(computerHand.indexOf(cardToDiscard), 1);
                discardPile.push(cardToDiscard);
                if (rankMap[cardToDiscard.rank] === '8') {
                    currentSuit = suitMap[Math.floor(Math.random() * 4)];
                    statusDiv.textContent = `Computer played an 8 and chose ${currentSuit}. Your turn.`;
                } else {
                    currentSuit = cardToDiscard.suit;
                    statusDiv.textContent = `Computer played ${rankMap[cardToDiscard.rank]}${suitMap[cardToDiscard.suit]}. Your turn.`;
                }
                displayHands();
                checkWin();
                if (computerHand.length > 0) {
                    playerTurn = true;
                }
            } else if (deck.length > 0) {
                let canPlay = false;
                while (deck.length > 0 && !canPlay) {
                    const newCard = deck.pop();
                    computerHand.push(newCard);
                    canPlay = canDiscard(newCard);
                    displayHands();
                    statusDiv.textContent = canPlay ? "Computer drew a playable card!" : "Computer drew a card.";
                    if (!canPlay) {
                        await wait(500);
                    }
                }
                if (!canPlay) {
                    statusDiv.textContent = "Computer couldn’t play. Your turn.";
                    playerTurn = true;
                } else {
                    computerTurn();
                }
            } else {
                statusDiv.textContent = "Computer passes. Your turn.";
                playerTurn = true;
            }
        }

        /** Checks for a win condition */
        function checkWin() {
            if (playerHand.length === 0) {
                winScreen.style.display = 'flex';
                disableButtons();
            } else if (computerHand.length === 0) {
                loseScreen.style.display = 'flex';
                disableButtons();
            }
        }

        /** Disables interaction buttons on game end */
        function disableButtons() {
            drawCardButton.disabled = true;
            discardButton.disabled = true;
        }

        /** Enables interaction buttons at game start */
        function enableButtons() {
            drawCardButton.disabled = false;
            discardButton.disabled = false;
        }

        /** Starts the game after welcome screen */
        function startGame() {
            welcomeScreen.style.display = 'none';
            startNewGame();
        }

        /** Restarts the game after win/lose */
        function restartGame() {
            winScreen.style.display = 'none';
            loseScreen.style.display = 'none';
            startNewGame();
        }

        /** Starts a new game */
        function startNewGame() {
            console.log("Starting new game...");
            createDeck();
            console.log("Deck created:", deck.length, "cards");
            shuffle(deck);
            console.log("Deck shuffled");
            dealCards();
            console.log("Cards dealt. Player hand:", playerHand, "Computer hand:", computerHand, "Discard pile:", discardPile);
            displayHands();
            console.log("Hands displayed");
            statusDiv.textContent = 'Your turn';
            playerTurn = true;
            selectedCardIndex = null;
            enableButtons();
        }
    </script>
</body>
</html>
