<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Memory Game</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #222222;
            text-align: center;
            position: relative;
            display: flex;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            flex-direction: column; /* Stack vertically */
        }
        #hud {
            background-color: #ff9000;
            color: white;
            padding: 5px 0; /* Reduced padding for smaller height */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: clamp(12px, 1.5vw, 16px); /* Smaller font for a tighter HUD */
            height: 40px; /* Fixed, smaller height */
            flex-shrink: 0; /* Prevent shrinking */
            width: 100%; /* Full width */
        }
        #hud > div:first-child { /* Level: */
            margin-left: 10px; /* 10px from left border */
        }
        #hud > div:last-child { /* Sound: On/Off */
            margin-right: 10px; /* 10px from right border */
        }
        #game-container {
            flex: 1; /* Take remaining height */
            display: grid;
            gap: 5px;
            padding: 5px;
            box-sizing: border-box;
            max-width: 100%; /* Allow full width of the window */
            margin: 0 auto; /* Center horizontally */
            /* outline: 2px solid red; */ /* Uncomment to debug */
        }
        .card {
            width: 100%;
            height: 0; /* Start with no height */
            padding-bottom: calc(350 / 225 * 100%); /* 2:3 ratio (350 / 225 = 1.5556) */
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi4nWmphL_nxFc_lDNsI8G_6-W8f78cK9TJH2nrklDrVANi60y_oGIJBSzYHDz8nyv36wi8XzSD1DqN0EtlxLalOYvEqszh-iFqbaCwmIPFqnD2arHtQoDV5oZ7hiSUZOmyrqDqbxh6SlMeZGCO5si4YvjH-rVJdHW94SIk5BRPr6ATOsfVGZetORScSTLT/s350/image.jpg');
            background-size: cover;
            background-position: center;
            touch-action: manipulation;
            /* outline: 1px solid yellow; */ /* Uncomment to debug */
        }
        .card img {
            width: 100%;
            height: 100%;
            display: none;
            border-radius: 5px;
            position: absolute;
            top: 0;
            left: 0;
            object-fit: cover;
        }
        .card.flipped {
            background-image: none;
        }
        .card.flipped img.card-front {
            display: block;
        }
        #game-container::after {
            content: '';
            display: block;
            grid-column: span 5; /* Span all columns */
            grid-row: span 6; /* Span all rows */
            visibility: hidden;
        }
        #game-over {
            display: none;
            background-color: rgba(0, 0, 0, 0.8);
            color: #ff9000;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
            font-size: clamp(16px, 3vw, 24px);
        }
        #game-over h2 {
            margin: 20px;
        }
        @media (max-width: 480px) {
            #game-container {
                grid-template-columns: repeat(4, 1fr); /* 4 columns on mobile */
                grid-template-rows: repeat(8, minmax(0, 1fr)); /* 8 rows to fit 30 cards */
                gap: 3px;
            }
            #hud {
                padding: 4px 0;
                height: 35px; /* Even smaller on mobile */
                font-size: clamp(10px, 1.5vw, 14px);
            }
            #hud > div:first-child {
                margin-left: 8px; /* Slightly reduced for mobile */
            }
            #hud > div:last-child {
                margin-right: 8px; /* Slightly reduced for mobile */
            }
        }
    </style>
</head>
<body>
    <div id="hud">
        <div id="level">Level: 1</div>
        <div id="time">Time: 10:00</div>
        <div id="sound" onclick="toggleSound()">Sound: On</div>
    </div>
    <div id="game-container"></div>
    <div id="game-over" onclick="startGame()">
        <h2 id="game-over-text"></h2>
        <p>Tap anywhere to play again!</p>
    </div>

    <script>
        const levels = [
            { time: 600, pairs: 15 },
            { time: 480, pairs: 15 },
            { time: 360, pairs: 15 },
            { time: 240, pairs: 15 },
            { time: 180, pairs: 15 }
        ];

        let currentLevel = 0;
        let timer;
        let timeLeft;
        let firstCard, secondCard;
        let lockBoard = false;
        let matchedPairs = 0;
        let isMuted = false;

        function startGame() {
            currentLevel = 0;
            matchedPairs = 0;
            document.getElementById('game-over').style.display = 'none';
            loadLevel();
            adjustGameHeight(); // Ensure height is correct on load
        }

        function loadLevel() {
            const level = levels[currentLevel];
            timeLeft = level.time;
            matchedPairs = 0;
            document.getElementById('level').innerText = `Level: ${currentLevel + 1}`;
            document.getElementById('time').innerText = `Time: ${formatTime(timeLeft)}`;
            createCards();
            startTimer();
            adjustGameHeight(); // Adjust height after creating cards
        }

        function createCards() {
            const gameContainer = document.getElementById('game-container');
            gameContainer.innerHTML = '';
            const cardImages = getCardImages();
            const cards = [...cardImages, ...cardImages];
            shuffle(cards);

            cards.forEach(image => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `<img src="${image}" alt="Card Image" class="card-front">`;
                card.addEventListener('click', flipCard);
                card.addEventListener('touchstart', handleTouchStart, { passive: false });
                gameContainer.appendChild(card);
            });
            updateGridLayout(); // Dynamically set grid layout based on cards
        }

        function getCardImages() {
            return [
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg9tw3TLwn1lz4rSrZafttewjkdCt1i-ujQdVE1VJd3hy4fakv6n4FlrbSR1a5TbXQpQIAmzy7ff455xQZF50T2HCCn-YQKB8PbJ4qo6Slkqp6yXM8yTAuJYXaxsLdZi9NG0xg1w_dKa3Xw6SqRbHzDzGMKALOOPuXuigdnq2wiV6mYv9ovVR5wcJzrr2Bk/s350/01.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3YXm1P87EC1jE652kTshUcOsTUmXMGFx2JtpGdtdI3VGEQWYgFuKQtb2ecGywDmJwR-9CbCrCAadsTZfIt-kv_6HEle9r52gb2YyqI9zSxdQjme7AKXcKP_IodqLg-9P9zKEwpEThtLRP8iQjRpzLnDfjKLcMFdSIZC0quERCghZC1QZdmGE49C0RoO8D/s350/02.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQhQTxb-P7yEHDenrSdVm5pgHS07Uk3t2Zm3PH3YR_gRNxSQ7ibZNBwWFIUfLPmr8sR8BJ5yxVw_Md1_3YYgfXUFJOCoMDVJyy4SUanrnUMkNmawlAEwEdQSVOPYN2R9aPKsLQzP0laRRelDFRiaiMulBTvjytdaTZHRbAegbcJkSte4VhQE-R2cjyzW5p/s350/03.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNh8zAkLps8cqERVNwM2qYi80fZNwC1z2XM4li0K-T202DthaymdZOLdsFcVa8NpZ4h-hfHH2Q0KynfM7StSIPy2Ei_sgsqQas4qFbvq2d0cRzF69D5C0Y-QUpio6FwV9uGwRWkA9q7Af7CxKlclcauU7rwhJg65D_ccTLCfID60uKvlmlmAWTv-Lb1hJ6/s350/04.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJfGYF2XfBQ1y8aWFCcIBBWr6hRISqEJP4hsHoTx_z5MsgFdP7eSeQGtn9FqXj00TJt8oYeQT6cPkgd8IL21ntLQCWl5d6KPQM193O65Dor0MZP_mIoeHSYoIfcT3O3cmshmB8ujdHxOmMTt7k_eGQgEgk3mDsj55Lvn_mkbzTOzfRGv-PJi-Qnl_N5viU/s350/05.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiGuEQjsAjM58uCpDuUNZisXR1F9s4LJ6ba0xbbbMimbL1G2OxkxuThOWkAJFQkfzM6pM2XTe3zGmO254llumlSkUPuXfhFHvZT0DJSd3h84fqPo1zEpt0qkRlaQSk1MwzKkiF5xlWJsxoHoWBLC4-TDpNxkYfpAOEW5bM4hQJCNANlJ9MNpywbjdpdDTW0/s350/06.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh4YKyHD7dGyJzSH3YUC7qZi0FyAEmoRhXu_qo0j0hq5yAfWjHXmUxX5oK9sLAjF-IbJV73lq1b_wcDlu_j00HTg0el089S0C3mykdyNtUSCwj2O9jd_ytZM7aiqQUwhnoNHM3X6ZT54ETyuU46Kmln32StZalQhFOKWHfTONOctH1a1IsNVETIVrz8TpOI/s350/07.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEix5TiTyDL8CrsON3Q0-7RyGv-uPp7Ug9DOQUXGrvJcOG3qmV0fVJoSPtyOdUaHvYcQytrqgRji52kM4aHprKRD_FoiIXMeitgggN72WyUHAaOMe6I3rMaWpMiBtM9IuIvSDFVip6vX97B1-jqsDC0uGQCZueEYznyXmTUKoHAW7hrVBoTb5BorFKwc6Ag5/s350/08.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmYqBWIawr2ZV7XmH2izLXFAaQ_0bekuAfTEKf7mX_DpJcmbQ-798J7hqeABiuBjYgmWzylHhkUVw98mymX4L1BW9CwdBTQiLpwvjFXGLQUlUBhMaWYPyBm6FvgXyMAzN4FaSSfjjxn0WVzQ9YsU1wHzgVFAUZqW5Hb-cGqrGeXdF-aEOnlydSkGsv6vEQ/s350/09.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg0EeTNLl8QYG9H-9Qu-gEpFcoAimXzj7VB8NcF6Iv2Z71g4vAIX_aJnAHoQPG2GeAV57COGhsLPYN5R0jozWnGGZ1mwoIkZ7aPAnRIi-E1kDD0bvYV9xPr1O_5ggxkre7ErO8OOXvM-D19bw13c4X6pVQGubOQWQJ-6lxG7Q7DlWk7KkX1ymp86VW3mQR6/s350/10.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPXWpr-x7wx3wBBX5Ix46dQwiV70GHqTD4BtT8hLBauBRN-mn3XZDdRl3kTrvLnHFU1BkhAaNqPbEDzrOUS2_OkHtkQXOj1IeiwNWk6iDZVo3kCI_zbrzPB2kVuZ5UXBFEN7xB3l6pKAhutAQDpDPQU7cPoJVdv4NzBRlkjYMsVxN-aXRZv7t1npt9HnQf/s350/11.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpOAf0ClUuaUY5pTpSUd_vc4YfyQehx5S2Hnyjn-u0PXXwNxJNgznbYRTYyzaWJoQ1TQSgM7Zz_liYkdKMSH0ISapNZuK6CGy1eYAZAufAEfpHXWelQ2_VcMc95xV0bC9TjwjdwbbEZ-AJysvk_7X2CF7JsdK26ETUQWMr8bwAPRS9D32ggdTt2n_oLFBv/s350/12.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBAsHgnrrDUblR5w39atXodEg3D62auM4XAkfv50RvMV2MYUXambigQctGtlclon26wi55jYjLyYHxODj-Ha_YjnSezbz5uLazjK_tCUnooGn3StpwMFOoqXG6tnEDxbLGFGWOVyKdmO69tlFRyGN2KcAldMh_ZtSHkQ6R2WVLEBUEziS7SnyT6zjKjDJz/s350/13.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhpIAS_cYESRNW084zWr6MOz7t0fgomVOScZ8qOVvKdYrlzScDx3lY1Hvir6ZKgAY5NRim_6B2F0_brjAKeMvQ2-E1aK6LJrqTaVu58-Gco24zX1ME1mvDGB649HWycmc6iqinLazTGIlex96D4IBGCu9zFW15fcJVaTr5DkKCmQbSAE6F9IxmYX14OJzlB/s350/14.jpg',
                'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg2E7ksXIJ_rUQI-BBM5KKhA4jEzYREWP5FYN4erLcuyrUY2Cw-iQJ7sqgHXm591l5O2EMdlMSg7xLdhcU3aFBCNZazdiI2xx6tbLCXQz0adm-K1mTpTz-MUDAupVVxG-vlkNOsVQZV7srTOwX4XUrW2DxgEcwtWm4rbWJEKv6fyXWCQoRYbiXdTUyvsJuJ/s350/15.jpg'
            ];
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function flipCard(e) {
            e.preventDefault();
            if (lockBoard || this.classList.contains('flipped')) return;
            this.classList.add('flipped');
            if (!isMuted) playBipSound();

            if (!firstCard) {
                firstCard = this;
            } else {
                secondCard = this;
                lockBoard = true;
                checkForMatch();
            }
        }

        function handleTouchStart(e) {
            e.preventDefault();
            flipCard.call(this, e);
        }

        function checkForMatch() {
            const firstImage = firstCard.querySelector('img.card-front').src;
            const secondImage = secondCard.querySelector('img.card-front').src;

            if (firstImage === secondImage) {
                matchedPairs++;
                if (!isMuted) playMatchSound();
                resetCards();
                if (matchedPairs === levels[currentLevel].pairs) {
                    levelUp();
                }
            } else {
                if (!isMuted) playUnmatchSound();
                setTimeout(() => {
                    firstCard.classList.remove('flipped');
                    secondCard.classList.remove('flipped');
                    resetCards();
                }, 1000);
            }
        }

        function resetCards() {
            [firstCard, secondCard] = [null, null];
            lockBoard = false;
        }

        function levelUp() {
            if (!isMuted) playLevelUpSound();
            currentLevel++;
            if (currentLevel < levels.length) {
                setTimeout(loadLevel, 1000);
            } else {
                gameOver(true);
            }
        }

        function startTimer() {
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('time').innerText = `Time: ${formatTime(timeLeft)}`;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    gameOver(false);
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function gameOver(win) {
            clearInterval(timer);
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('game-over-text').innerText = win ? "Congratulations, you won!" : "Game Over!";
            if (!isMuted) win ? playGameOverWinSound() : playGameOverLossSound();
        }

        function toggleSound() {
            isMuted = !isMuted;
            document.getElementById('sound').innerText = isMuted ? "Sound: Off" : "Sound: On";
        }

        function playBipSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function playMatchSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'triangle';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playUnmatchSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function playLevelUpSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playGameOverLossSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function playGameOverWinSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Function to dynamically adjust game height and width
        function adjustGameHeight() {
            const gameContainer = document.getElementById('game-container');
            const windowHeight = window.innerHeight || document.documentElement.clientHeight;
            const hudHeight = document.getElementById('hud').offsetHeight;
            const availableHeight = windowHeight - hudHeight - 10; // Account for padding
            const cardHeight = Math.min(availableHeight / 6, 350); // Limit card height to 350px max
            const cardWidth = cardHeight * (225 / 350); // Maintain 2:3 ratio (225x350)
            const totalWidth = cardWidth * 5 + 20; // 5 cards + gaps + padding

            gameContainer.style.gridTemplateColumns = `repeat(5, ${cardWidth}px)`;
            gameContainer.style.gridTemplateRows = `repeat(6, ${cardHeight}px)`;
            gameContainer.style.width = `${totalWidth}px`; // Set exact width for cards
            gameContainer.style.maxWidth = '100%'; // Ensure it fits within window
            gameContainer.style.height = '100%'; // Scale to full available height
            gameContainer.style.minHeight = `${cardHeight * 6 + 10}px`; // Minimum height for 6 rows + padding
        }

        // Function to dynamically set grid layout based on cards
        function updateGridLayout() {
            const cards = document.querySelectorAll('.card');
            if (cards.length === 30) { // 30 cards for 5x6 grid
                adjustGameHeight();
            }
        }

        // Adjust height on load and resize
        window.onload = () => {
            startGame();
            window.addEventListener('resize', adjustGameHeight);
        };
    </script>
</body>
</html>
